#!/bin/bash
sudo useradd dynatrace
sudo groupadd dynatrace
sudo usermod -a -G dynatrace dynatrace
sudo chown -R dynatrace:dynatrace /opt/dynatrace
sudo chown -R dynatrace:dynatrace /opt/dynatrace-7.0

sudo yum update -y
sudo yum install java-1.8.0-openjdk wget -y
sudo wget https://files.dynatrace.com/downloads/OnPrem/dynaTrace/7.0/7.0.0.2429/dynatrace-collector-7.0.0.2429-linux-x86.jar -P /opt
sudo /usr/bin/java8 -jar /opt/dynatrace-collector-7.0.0.2429-linux-x86.jar -y
sudo ln -s /opt/dynatrace-7.0 /opt/dynatrace
sudo cp /opt/dynatrace/init.d/dynaTraceCollector /etc/init.d
sudo sed -i -e 's,DT_HOME="/opt/dynatrace-7.0",DT_HOME="/opt/dynatrace",g' /etc/init.d/dynaTraceCollector
sudo sed -i -e 's,DT_OPTARGS=,DT_OPTARGS="-server 10.0.0.1 -group My_Collector_Group",g' /etc/init.d/dynaTraceCollector
sudo sed -i -e 's,DT_RUNASUSER=,DT_RUNASUSER=dynatrace,g' /etc/init.d/dynaTraceCollector
sudo chkconfig --add /etc/init.d/dynaTraceCollector
sudo service dynaTraceCollector start
